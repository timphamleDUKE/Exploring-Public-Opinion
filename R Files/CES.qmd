---
title: "test"
format: html
---

```{r}
#| label: packages
#| message: FALSE

library(tidyverse)
library(readr)
library(here)
```

```{r}
#| label: data
#| message: FALSE
#| warning: FALSE

ces_2024_clean <- read_csv("../Python Files/Streamlit/data/CES_2024_clean.csv")
```

```{r}
#| label: ces-data

ces_2024_clean |>
  mutate(CC24_321b = ifelse(CC24_321b == 1, "Support", "Oppose")) |>
  group_by(CC24_321b) |>
  mutate(weighted_count = sum(commonweight, na.rm = TRUE)) |>
  ggplot(aes(y = CC24_321b, x = weighted_count)) +
  geom_col() +
  scale_x_continuous(labels = scales::comma_format()) +
  labs(
    title = "On the issue of gun regulation, do you support or oppose a 
    proposal that would do the following?: Make it easier for people to 
    obtain concealed-carry permits"
  ) +
  theme_minimal()

ces_2024_clean |>
  mutate(CC24_321b = if_else(CC24_321b == 1, "Support", "Oppose"), 
         poli_party_reg = case_when(
           poli_party_reg == 1 ~ "No Party, Independent, Declined to State", 
           poli_party_reg == 2 ~ "Democratic Party", 
           poli_party_reg == 3 ~ "Republican Party", 
           poli_party_reg == 4 ~ "Other", 
           poli_party_reg == 5 ~ NA
         )) |>
  group_by(CC24_321b) |>
  mutate(weighted_count = sum(commonweight, na.rm = TRUE)) |>
  ggplot(aes(y = poli_party_reg, x = weighted_count)) +
  geom_col(aes(fill = CC24_321b), position = "fill") +
  scale_x_continuous(labels = scales::comma_format()) +
  labs(
    title = "On the issue of gun regulation, do you support or oppose a 
    proposal that would do the following?: Make it easier for people to 
    obtain concealed-carry permits"
  ) +
  theme_minimal()

ces_2024_clean |>
  mutate(CC24_321b = if_else(CC24_321b == 1, "Support", "Oppose"), 
         poli_party_reg = case_when(
           poli_party_reg == 1 ~ "No Party, Independent, Declined to State", 
           poli_party_reg == 2 ~ "Democratic Party", 
           poli_party_reg == 3 ~ "Republican Party", 
           poli_party_reg == 4 ~ "Other", 
           poli_party_reg == 5 ~ "N"
         ), 
         gender = case_when(
           gender == 1 ~ "Male", 
           gender == 2 ~ "Female", 
           TRUE ~ "Other"
         )) |>
  group_by(CC24_321b) |>
  mutate(weighted_count = sum(commonweight, na.rm = TRUE)) |>
  ggplot(aes(y = poli_party_reg, x = weighted_count)) +
  geom_col(aes(fill = CC24_321b), position = "fill") +
  facet_grid(gender ~ .) +
  scale_x_continuous(labels = scales::comma_format()) +
  labs(
    title = "On the issue of gun regulation, do you support or oppose a 
    proposal that would do the following?: Make it easier for people to 
    obtain concealed-carry permits"
  ) +
  theme_minimal()

```
