---
title: "test"
format: html
---

```{r}
#| label: packages
#| message: FALSE

library(tidyverse)
library(readr)
library(here)
```

```{r}
#| label: data
#| message: FALSE
#| warning: FALSE

anes_2024_clean <- read_csv("../Python Files/Streamlit/data/ANES_2024_clean.csv")
ces_2024_clean <- read_csv("../Python Files/Streamlit/data/CES_2024_clean.csv")
```

```{r}
anes_2024_clean |>
  count(V242325)
```


```{r}
#| label: data-clean
#| message: FALSE
#| warning: FALSE

anes_2024_clean |>
  filter(V242325 > 0) |>
  mutate(V242325 = case_when(
    V242325 == -9 ~ "Refused", 
    V242325 == -8 ~ "Don’t know",
    V242325 == -7 ~ "Insufficient partial, interview deleted",
    V242325 == -6 ~ "No post interview",
    V242325 == -5 ~ "Sufficient partial, breakoff",
    V242325 == -1 ~ "Inapplicable",
    V242325 == 1 ~ "More difficult",
    V242325 == 2 ~ "Easier",
    V242325 == 3 ~ "Keep these rules about the same"
  )) |>
  group_by(V242325) |>
  mutate(weighted_count = sum(pre_full, na.rm = TRUE)) |>
  ggplot(aes(y = V242325, x = weighted_count)) +
  geom_col() +
  scale_x_continuous(labels = scales::comma_format()) +
  labs(
    title = "Do you think the federal government should make it more
difficult for people to buy a gun than it is now, make it easier
for people to buy a gun, or keep these rules about the same
as they are now?"
  ) +
  theme_minimal()

anes_2024_clean |>
  filter(V242325 > 0) |>
  filter(poli_party_reg > 0) |>
  mutate(V242325 = case_when(
    V242325 == -9 ~ "Refused", 
    V242325 == -8 ~ "Don’t know",
    V242325 == -7 ~ "Insufficient partial, interview deleted",
    V242325 == -6 ~ "No post interview",
    V242325 == -5 ~ "Sufficient partial, breakoff",
    V242325 == -1 ~ "Inapplicable",
    V242325 == 1 ~ "More difficult",
    V242325 == 2 ~ "Easier",
    V242325 == 3 ~ "Keep these rules about the same"
  ), 
  poli_party_reg = case_when(
    poli_party_reg == -9 ~ "Refused",
    poli_party_reg == -8 ~ "Don’t know",
    poli_party_reg == -1 ~ "Inapplicable",
    poli_party_reg == 1 ~ "Democratic party",
    poli_party_reg == 2 ~ "Republican party",
    poli_party_reg == 4 ~ "None or independent",
    poli_party_reg == 5 ~ "Another party"
  )) |>
  group_by(V242325) |>
  mutate(weighted_count = sum(pre_full, na.rm = TRUE)) |>
  ggplot(aes(y = poli_party_reg, x = weighted_count)) +
  geom_col(aes(fill = V242325), position = "fill") +
  scale_x_continuous(labels = scales::comma_format()) +
  labs(
    title = "Do you think the federal government should make it more
difficult for people to buy a gun than it is now, make it easier
for people to buy a gun, or keep these rules about the same
as they are now?"
  ) +
  theme_minimal()
```

